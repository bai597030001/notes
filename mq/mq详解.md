# 消息队列



## 什么是消息队列



## 消息队列的作用

### 1.解耦

### 2.异步操作

### 3.削峰/限流



## 消息队列注意事项

### 1.高可用

无论是我们使用消息队列来做解耦、异步还是削峰，消息队列**肯定不能是单机**的。试着想一下，如果是单机的消息队列，万一这台机器挂了，那我们整个系统几乎就是不可用了。

### 2.数据丢失问题/持久化

我们将数据写到消息队列上，系统B和C还没来得及取消息队列的数据，就挂掉了。**如果没有做任何的措施，我们的数据就丢了**。

- 磁盘？
- 数据库？
- Redis？
- 分布式文件系统？
- 同步存储还是异步存储？

### 3.消费者怎么得到消息队列的数据

消费者怎么从消息队列里边得到数据？有两种办法：

- 生产者将数据放到消息队列中，消息队列有数据了，**主动叫**消费者去拿(俗称push)
- 消费者不断去**轮训**消息队列，看看有没有新的数据，如果有就消费(俗称pull)

### 4.顺序消费怎么保证

在生产中经常会有一些类似报表系统这样的系统，需要做 MySQL 的 binlog 同步。比如订单系统要同步订单表的数据到大数据部门的 MySQL 库中用于报表统计分析，通常的做法是基于 Canal 这样的中间件去监听订单数据库的 binlog，然后把这些 binlog 发送到 MQ 中，再由消费者从 MQ 中获取 binlog 落地到大数据部门的 MySQL 中。

﻿

在这个过程中，可能会有对某个订单的增删改操作，比如有三条 binlog 执行顺序是增加、修改、删除；消费者愣是换了顺序给执行成删除、修改、增加，这样肯定是不行的

### 5.如何防止消息重复消费



# JMS 规范

讲消息队列就不得不提JMS 。JMS（JAVA Message Service,java消息服务）API是一个消息服务的标准/规范，允许应用程序组件基于JavaEE平台创建、发送、接收和读取消息。它使分布式通信耦合度更低，消息服务更加可靠以及异步性。



# 常用消息队列

一般商用的容器，比如WebLogic，JBoss，都支持JMS标准，开发上很方便。但免费的比如Tomcat，Jetty等则需要使用第三方的消息中间件。



![](img/mq1.png)

# Spring 整合

不同于 RabbitMQ、ActiveMQ、Kafka 等消息中间件，Spring 社区已经通过多种方式提供了对这些中间件产品集成，

例如通过 spring-jms 整合 ActiveMQ、通过 Spring AMQP 项目下的 spring-rabbit 整合 RabbitMQ、通过 spring-kafka 整合 kafka ，通过他们可以在 Spring 项目中更方便使用其 API 。